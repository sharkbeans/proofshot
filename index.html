<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Proofshot - Create custom photocard proofshots">
    <title>Proofshot</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- QRCode.js -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <!-- GIF Parsing Library -->
    <script src="https://unpkg.com/gifuct-js@2.1.2/dist/gifuct-js.umd.js"></script>

    <!-- Fallback GIF Parser -->
    <script src="https://cdn.jsdelivr.net/npm/omggif@1.0.10/omggif.min.js"></script>

    <!-- GIF Encoding Library for Export -->
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>

    <!-- Debug: Check what's loaded -->
    <script>
        console.log('GIF Libraries Check:');
        console.log('- window.gifuct:', typeof window.gifuct);
        console.log('- window.GifuctJs:', typeof window.GifuctJs);
        console.log('- window.GifReader:', typeof window.GifReader);
        console.log('All window properties with "gif":', Object.keys(window).filter(k => k.toLowerCase().includes('gif')));
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Home Screen -->
            <div class="mobile-home" id="mobile-home">
                <div class="mobile-home-content">
                    <div class="mobile-home-icon">
                        <i data-lucide="camera" style="width: 80px; height: 80px;"></i>
                    </div>
                    <h2 class="mobile-home-title">Ready to Create?</h2>
                    <p class="mobile-home-description">Take a photo of your photocard with your camera</p>
                    <button class="btn-launch-camera" id="launch-camera-btn">
                        <i data-lucide="camera"></i>
                        <span>Launch Camera</span>
                    </button>
                </div>
            </div>

            <!-- Canvas Container -->
            <div class="canvas-container">
                <canvas id="proofshot-canvas"></canvas>
                <div class="canvas-overlay hidden" id="canvas-overlay">
                    <p class="upload-prompt">Press + to add Photocard</p>
                </div>
                <!-- Edit Mode Toggle -->
                <div class="edit-mode-toggle" id="edit-mode-toggle">
                    <button class="edit-mode-btn active" data-mode="photocard" id="edit-mode-photocard">
                        <i data-lucide="credit-card"></i>
                        <span>Photocard</span>
                    </button>
                    <button class="edit-mode-btn" data-mode="background" id="edit-mode-background">
                        <i data-lucide="image"></i>
                        <span>Background</span>
                    </button>
                    <div class="edit-mode-hint" id="edit-mode-hint">
                        Toggle Background to adjust background
                    </div>
                </div>
                <!-- Camera Controls Overlay -->
                <div class="camera-controls" id="camera-controls">
                    <div class="camera-controls-top-row">
                        <button class="camera-reset-photocard-btn" id="camera-reset-photocard-btn">
                            <i data-lucide="refresh-cw"></i>
                            <span>Reset</span>
                        </button>
                        <button class="camera-shutter-btn" id="camera-shutter-btn">
                            <div class="shutter-ring">
                                <div class="shutter-inner"></div>
                            </div>
                        </button>
                        <button class="camera-aspect-ratio-btn" id="camera-aspect-ratio-btn">3:4</button>
                    </div>
                    <!-- Camera Zoom Controls -->
                    <div class="camera-zoom-controls" id="camera-zoom-controls">
                        <button class="camera-zoom-btn" id="camera-zoom-out-btn" title="Zoom Out">
                            <i data-lucide="zoom-out"></i>
                        </button>
                        <input type="range" class="camera-zoom-slider" id="camera-zoom-slider" min="1" max="10" value="1" step="0.1" title="Camera Zoom">
                        <button class="camera-zoom-btn" id="camera-zoom-in-btn" title="Zoom In">
                            <i data-lucide="zoom-in"></i>
                        </button>
                    </div>
                    <button class="camera-upload-bg-btn" id="camera-upload-bg-btn">
                        <i data-lucide="image"></i>
                    </button>
                    <button class="camera-add-photocard-btn" id="camera-add-photocard-btn">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
            </div>

            <!-- Camera Action Buttons (below canvas on mobile) -->
            <div class="camera-action-buttons" id="camera-action-buttons">
                <button class="camera-discard-btn" id="camera-discard-btn">
                    <i data-lucide="rotate-ccw"></i>
                    <span>Retake</span>
                </button>
                <button class="camera-save-btn" id="camera-save-btn">
                    <i data-lucide="check"></i>
                    <span>Save</span>
                </button>
            </div>

            <!-- Toolbar -->
            <div class="toolbar" id="toolbar">
                <button class="toolbar-toggle" id="toolbar-toggle" aria-label="Toggle toolbar">
                    <i data-lucide="chevron-down" id="toolbar-toggle-icon"></i>
                </button>
                <!-- Upload Section -->
                <div class="toolbar-section">
                    <h3 class="section-title">Upload</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" id="upload-bg-btn">
                            <i data-lucide="image"></i>
                            <span>Background</span>
                        </button>
                        <button class="btn btn-primary mobile-only" id="camera-btn">
                            <i data-lucide="camera"></i>
                            <span>Camera</span>
                        </button>
                        <button class="btn btn-primary" id="upload-photocard-btn">
                            <i data-lucide="credit-card"></i>
                            <span>Photocard</span>
                        </button>
                    </div>
                </div>

                <!-- Background Controls Section -->
                <div class="toolbar-section controls-section" id="background-controls">
                    <h3 class="section-title">
                        <i data-lucide="image"></i>
                        Background Controls
                    </h3>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Position X</span>
                            <input type="range" id="bg-x-slider" min="-500" max="500" value="0" step="1">
                            <span class="control-value" id="bg-x-value">0</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Position Y</span>
                            <input type="range" id="bg-y-slider" min="-500" max="500" value="0" step="1">
                            <span class="control-value" id="bg-y-value">0</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Scale</span>
                            <input type="range" id="bg-scale-slider" min="0.1" max="3" value="1" step="0.01">
                            <span class="control-value" id="bg-scale-value">1.00</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Rotation</span>
                            <input type="range" id="bg-rotation-slider" min="-180" max="180" value="0" step="1">
                            <span class="control-value" id="bg-rotation-value">0°</span>
                        </label>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-sm" id="bg-flip-h-btn" title="Flip Horizontal">
                            <i data-lucide="flip-horizontal"></i>
                        </button>
                        <button class="btn btn-sm" id="bg-flip-v-btn" title="Flip Vertical">
                            <i data-lucide="flip-vertical"></i>
                        </button>
                        <button class="btn btn-sm" id="bg-reset-btn" title="Reset Background">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                    </div>
                </div>

                <!-- Photocard Controls Section -->
                <div class="toolbar-section controls-section" id="photocard-controls">
                    <h3 class="section-title">
                        <i data-lucide="credit-card"></i>
                        Photocard Controls
                    </h3>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Position X</span>
                            <input type="range" id="photocard-x-slider" min="0" max="1000" value="0" step="1">
                            <span class="control-value" id="photocard-x-value">0</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Position Y</span>
                            <input type="range" id="photocard-y-slider" min="0" max="1000" value="0" step="1">
                            <span class="control-value" id="photocard-y-value">0</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Scale</span>
                            <input type="range" id="photocard-scale-slider" min="0.1" max="5" value="1" step="0.01">
                            <span class="control-value" id="photocard-scale-value">1.00</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label">
                            <span>Rotation</span>
                            <input type="range" id="photocard-rotation-slider" min="-180" max="180" value="0" step="1">
                            <span class="control-value" id="photocard-rotation-value">0°</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="control-label checkbox-label">
                            <input type="checkbox" id="toploader-toggle" checked>
                            <span>Show Toploader</span>
                        </label>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-sm" id="photocard-flip-h-btn" title="Flip Horizontal">
                            <i data-lucide="flip-horizontal"></i>
                        </button>
                        <button class="btn btn-sm" id="photocard-flip-v-btn" title="Flip Vertical">
                            <i data-lucide="flip-vertical"></i>
                        </button>
                        <button class="btn btn-sm" id="photocard-reset-btn" title="Reset Photocard">
                            <i data-lucide="refresh-cw"></i>
                            <span>Reset</span>
                        </button>
                        <button class="btn btn-sm" id="photocard-reset-transform-btn" title="Reset Photocard Position & Size">
                            <i data-lucide="move"></i>
                            <span>Reset Position</span>
                        </button>
                    </div>
                </div>

                <!-- Layer Section -->
                <div class="toolbar-section">
                    <h3 class="section-title">Layer Order</h3>
                    <div class="button-group">
                        <button class="btn" id="bring-front-btn" title="Bring to Front">
                            <i data-lucide="bring-to-front"></i>
                            <span>Front</span>
                        </button>
                        <button class="btn" id="send-back-btn" title="Send to Back">
                            <i data-lucide="send-to-back"></i>
                            <span>Back</span>
                        </button>
                    </div>
                </div>

                <!-- Border Section - Hidden (only 'None' option available) -->
                <div class="toolbar-section" style="display: none;">
                    <h3 class="section-title">Border</h3>
                    <div class="border-selector" id="border-selector">
                        <!-- Border options will be populated by borders.js -->
                    </div>
                </div>

                <!-- Actions Section -->
                <div class="toolbar-section">
                    <h3 class="section-title">Actions</h3>
                    <div class="button-group">
                        <button class="btn" id="reset-btn" title="Reset Canvas">
                            <i data-lucide="refresh-cw"></i>
                            <span>Reset</span>
                        </button>
                        <button class="btn btn-success" id="save-btn" title="Save Proofshot">
                            <span>Save</span>
                        </button>
                        <button class="btn" id="save-video-btn" title="Save as Video">
                            <i data-lucide="video"></i>
                            <span>Save as Video</span>
                        </button>
                        <button class="btn" id="qr-btn" title="Generate QR Code">
                            <i data-lucide="qr-code"></i>
                            <span>QR</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
        </footer>
    </div>

    <!-- Hidden File Inputs -->
    <input type="file" id="bg-file-input" accept="image/*,image/gif,video/*" style="display: none;">
    <input type="file" id="photocard-file-input" accept="image/*,image/gif,video/*" style="display: none;">

    <!-- Hidden Video Element for Camera -->
    <video id="camera-video" autoplay playsinline style="display: none;"></video>

    <!-- QR Code Modal -->
    <div class="modal" id="qr-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Your Proofshot</h2>
                <button class="modal-close" id="qr-modal-close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="qr-code-container"></div>
                <input type="text" id="share-url" readonly class="share-url-input">
                <button class="btn btn-primary" id="copy-url-btn">
                    <i data-lucide="copy"></i>
                    <span>Copy Link</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div class="modal" id="save-confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>What's Next?</h2>
                <button class="modal-close" id="save-confirmation-modal-close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="button-group" style="flex-direction: column; gap: 12px;">
                    <button class="btn btn-primary" id="keep-editing-btn" style="width: 100%;">
                        <i data-lucide="edit"></i>
                        <span>Keep Editing</span>
                    </button>
                    <button class="btn" id="discard-image-btn" style="width: 100%;">
                        <i data-lucide="trash-2"></i>
                        <span>Discard Image</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/borders.js"></script>
    <script src="js/toploader-config.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
